<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WP - Planner 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5eead4',
                        primaryDark: '#0f766e',
                        bgLight: '#f3f4f6',
                        bgDark: '#0f172a',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Tajawal', sans-serif; transition: background-color 0.3s, color 0.3s; }
        .hidden-section { display: none !important; }
        .dragging { opacity: 0.5; transform: scale(0.95); }
        .column-drop-zone { min-height: 200px; transition: background 0.2s; }
        .drag-over { background-color: rgba(94, 234, 212, 0.1); border: 2px dashed #5eead4; }
        .active-tab { background-color: #0f766e !important; color: white !important; }
        .nav-link { cursor: pointer; transition: all 0.3s; }
    </style>
</head>
<body class="bg-bgLight dark:bg-bgDark text-slate-800 dark:text-slate-200 min-h-screen">

    <div class="fixed top-5 left-5 z-50">
        <button onclick="toggleTheme()" class="p-3 rounded-full bg-white dark:bg-slate-700 shadow-lg hover:scale-110 transition-transform">
            <span id="themeIcon">ğŸŒ™</span>
        </button>
    </div>

    <div id="authSection" class="min-h-screen flex items-center justify-center px-4">
        <div class="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-xl w-full max-w-md border border-slate-100 dark:border-slate-700">
            <h1 class="text-4xl font-bold text-center text-primaryDark dark:text-primary mb-2">WP 2026</h1>
            <p class="text-center text-slate-500 dark:text-slate-400 mb-8 font-medium">Ø®Ø·Ø· Ù„Ø¹Ø§Ù…Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨ÙƒÙ„ Ø³Ù‡ÙˆÙ„Ø©</p>
            <div id="authError" class="hidden bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 p-3 rounded-lg text-sm mb-4 text-center"></div>
            <div class="space-y-4">
                <input type="email" id="emailInput" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full px-4 py-3 rounded-xl border dark:bg-slate-700 dark:border-slate-600 outline-none focus:ring-2 focus:ring-primary">
                <input type="password" id="passInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full px-4 py-3 rounded-xl border dark:bg-slate-700 dark:border-slate-600 outline-none focus:ring-2 focus:ring-primary">
                <button onclick="handleLogin()" class="w-full bg-primaryDark hover:bg-teal-800 text-white py-3 rounded-xl font-bold transition">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <button onclick="handleRegister()" class="w-full border-2 border-primaryDark text-primaryDark dark:text-primary py-3 rounded-xl font-bold hover:bg-teal-50 dark:hover:bg-slate-700 transition">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden-section">
        <nav class="bg-white dark:bg-slate-800 shadow-md sticky top-0 z-40 mb-6">
            <div class="container mx-auto px-4 flex justify-between items-center h-16">
                <span class="text-2xl font-bold text-primaryDark dark:text-primary">WP 2026</span>
                <div class="flex gap-2 md:gap-4">
                    <button onclick="switchTab('goals')" id="tab-goals" class="nav-link px-3 py-2 rounded-lg text-sm font-bold bg-slate-100 dark:bg-slate-700">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                    <button onclick="switchTab('monthly')" id="tab-monthly" class="nav-link px-3 py-2 rounded-lg text-sm font-bold bg-slate-100 dark:bg-slate-700">Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ</button>
                    <button onclick="switchTab('weekly')" id="tab-weekly" class="nav-link px-3 py-2 rounded-lg text-sm font-bold bg-slate-100 dark:bg-slate-700">Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
                    <button onclick="logout()" class="px-3 py-2 rounded-lg text-sm font-bold bg-red-100 text-red-600 dark:bg-red-900/30">Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto px-4 pb-10 max-w-5xl">
            <div class="mb-6 text-center">
                <p id="userDisplay" class="text-slate-500 font-bold"></p>
                <h2 id="sectionTitle" class="text-2xl font-bold mt-2">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
            </div>

            <div class="max-w-xl mx-auto flex gap-2 mb-10">
                <input type="text" id="taskInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ù…Ø© Ù‡Ù†Ø§..." 
                    class="flex-1 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl px-5 py-3 shadow-sm outline-none focus:ring-2 focus:ring-primary">
                <button onclick="addTask()" class="bg-primaryDark hover:bg-teal-800 text-white rounded-xl px-6 py-2 font-bold shadow-lg">Ø¥Ø¶Ø§ÙØ©</button>
            </div>

            <div id="selectionBar" class="mb-8 overflow-x-auto pb-2 flex md:justify-center gap-2"></div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-md border-t-4 border-red-400">
                    <h3 class="font-bold mb-4 flex justify-between">ğŸ›‘ Ù„Ù„Ù‚ÙŠØ§Ù… Ø¨Ù‡Ø§ <span id="count-todo" class="bg-red-50 dark:bg-red-900/20 px-2 py-0.5 rounded text-xs">0</span></h3>
                    <div id="col-todo" class="column-drop-zone space-y-3" ondragover="allowDrop(event)" ondragleave="leaveDrop(event)" ondrop="handleDrop(event, 'todo')"></div>
                </div>
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-md border-t-4 border-yellow-400">
                    <h3 class="font-bold mb-4 flex justify-between">ğŸš§ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ <span id="count-doing" class="bg-yellow-50 dark:bg-yellow-900/20 px-2 py-0.5 rounded text-xs">0</span></h3>
                    <div id="col-doing" class="column-drop-zone space-y-3" ondragover="allowDrop(event)" ondragleave="leaveDrop(event)" ondrop="handleDrop(event, 'doing')"></div>
                </div>
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-4 shadow-md border-t-4 border-green-400">
                    <h3 class="font-bold mb-4 flex justify-between">âœ… ØªÙ… Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² <span id="count-done" class="bg-green-50 dark:bg-green-900/20 px-2 py-0.5 rounded text-xs">0</span></h3>
                    <div id="col-done" class="column-drop-zone space-y-3" ondragover="allowDrop(event)" ondragleave="leaveDrop(event)" ondrop="handleDrop(event, 'done')"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const days = ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'];
        const months = ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ', 'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
        
        let currentTab = 'goals'; // goals, monthly, weekly
        let selectedSubKey = '2026'; // Year, Month Name, or Day Name
        let currentUser = JSON.parse(localStorage.getItem('wp_logged_in')) || null;

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Tabs)
        function switchTab(tab) {
            currentTab = tab;
            if(tab === 'goals') {
                selectedSubKey = 'main_2026';
                document.getElementById('selectionBar').classList.add('hidden-section');
                document.getElementById('sectionTitle').innerText = 'Ø£Ù‡Ø¯Ø§Ù Ø¹Ø§Ù… 2026 Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©';
            } else if(tab === 'monthly') {
                selectedSubKey = months[new Date().getMonth()];
                document.getElementById('selectionBar').classList.remove('hidden-section');
                document.getElementById('sectionTitle').innerText = 'Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø´Ù‡Ø±ÙŠ';
                renderSelectionBar(months);
            } else {
                selectedSubKey = days[new Date().getDay() === 6 ? 0 : new Date().getDay() + 1];
                document.getElementById('selectionBar').classList.remove('hidden-section');
                document.getElementById('sectionTitle').innerText = 'Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ';
                renderSelectionBar(days);
            }
            updateTabUI();
            renderBoard();
        }

        function renderSelectionBar(items) {
            const container = document.getElementById('selectionBar');
            container.innerHTML = '';
            items.forEach(item => {
                const btn = document.createElement('button');
                btn.innerText = item;
                btn.className = `px-4 py-2 rounded-xl text-xs font-bold transition-all ${item === selectedSubKey ? 'bg-primaryDark text-white' : 'bg-white dark:bg-slate-700'}`;
                btn.onclick = () => { selectedSubKey = item; renderSelectionBar(items); renderBoard(); };
                container.appendChild(btn);
            });
        }

        function updateTabUI() {
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active-tab'));
            document.getElementById('tab-' + currentTab).classList.add('active-tab');
        }

        // Ù†ÙØ³ Ù…Ù†Ø·Ù‚ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø³Ø§Ø¨Ù‚ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function addTask() {
            const input = document.getElementById('taskInput');
            if(!input.value.trim()) return;
            // Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: currentUser.tasks[currentTab][selectedSubKey]
            if(!currentUser.tasks[currentTab]) currentUser.tasks[currentTab] = {};
            if(!currentUser.tasks[currentTab][selectedSubKey]) currentUser.tasks[currentTab][selectedSubKey] = [];
            
            currentUser.tasks[currentTab][selectedSubKey].push({ id: 't-'+Date.now(), text: input.value, status: 'todo' });
            input.value = '';
            saveData();
        }

        function renderBoard() {
            const cols = { todo: document.getElementById('col-todo'), doing: document.getElementById('col-doing'), done: document.getElementById('col-done') };
            Object.values(cols).forEach(c => c.innerHTML = '');
            let countMap = { todo: 0, doing: 0, done: 0 };
            
            const tasks = (currentUser.tasks[currentTab] && currentUser.tasks[currentTab][selectedSubKey]) ? currentUser.tasks[currentTab][selectedSubKey] : [];

            tasks.forEach(task => {
                countMap[task.status]++;
                const div = document.createElement('div');
                div.id = task.id; div.draggable = true;
                div.className = 'bg-white dark:bg-slate-700 p-4 rounded-lg shadow-sm border border-slate-100 dark:border-slate-600 cursor-move flex justify-between group';
                div.ondragstart = (e) => e.dataTransfer.setData("text", e.target.id);
                div.innerHTML = `<span class="dark:text-slate-200">${task.text}</span><button onclick="deleteTask('${task.id}')" class="text-red-400 opacity-0 group-hover:opacity-100 transition px-2">âœ•</button>`;
                cols[task.status].appendChild(div);
            });
            ['todo', 'doing', 'done'].forEach(k => document.getElementById('count-'+k).innerText = countMap[k]);
        }

        function deleteTask(id) {
            currentUser.tasks[currentTab][selectedSubKey] = currentUser.tasks[currentTab][selectedSubKey].filter(t => t.id !== id);
            saveData();
        }

        function saveData() {
            localStorage.setItem('wp_logged_in', JSON.stringify(currentUser));
            let users = JSON.parse(localStorage.getItem('wp_users')) || [];
            let idx = users.findIndex(u => u.email === currentUser.email);
            if(idx !== -1) {
                users[idx] = currentUser;
                localStorage.setItem('wp_users', JSON.stringify(users));
            }
            renderBoard();
        }

        // Drag & Drop
        window.allowDrop = (e) => { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
        window.leaveDrop = (e) => e.currentTarget.classList.remove('drag-over');
        window.handleDrop = (e, status) => {
            e.preventDefault(); e.currentTarget.classList.remove('drag-over');
            const id = e.dataTransfer.getData("text");
            const task = currentUser.tasks[currentTab][selectedSubKey].find(t => t.id === id);
            if(task) { task.status = status; saveData(); }
        }

        // Auth & Theme
        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.theme = isDark ? 'dark' : 'light';
            document.getElementById('themeIcon').innerText = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        }
        function handleRegister() {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;
            if(!email || !pass) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ ÙƒØ§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„");
            let users = JSON.parse(localStorage.getItem('wp_users')) || [];
            if(users.find(u => u.email === email)) return alert("Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹");
            users.push({ email, pass, tasks: { goals: {}, monthly: {}, weekly: {} } });
            localStorage.setItem('wp_users', JSON.stringify(users));
            alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!");
        }
        function handleLogin() {
            const email = document.getElementById('emailInput').value;
            const pass = document.getElementById('passInput').value;
            let users = JSON.parse(localStorage.getItem('wp_users')) || [];
            let user = users.find(u => u.email === email && u.pass === pass);
            if(user) {
                currentUser = user;
                localStorage.setItem('wp_logged_in', JSON.stringify(user));
                checkAuth();
            } else { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); }
        }
        function logout() { localStorage.removeItem('wp_logged_in'); location.reload(); }
        function checkAuth() {
            if(currentUser) {
                document.getElementById('authSection').classList.add('hidden-section');
                document.getElementById('mainApp').classList.remove('hidden-section');
                document.getElementById('userDisplay').innerText = `Ø£Ù‡Ù„Ø§Ù‹: ${currentUser.email}`;
                switchTab('goals');
            }
        }

        // Run
        if(localStorage.theme === 'dark') document.documentElement.classList.add('dark');
        checkAuth();
    </script>
</body>
</html>
