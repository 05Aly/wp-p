

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WP - Planner 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { primary: '#5eead4', primaryDark: '#0f766e', bgLight: '#f3f4f6', bgDark: '#0f172a' }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Tajawal', sans-serif; transition: all 0.3s; }
        .hidden-section { display: none !important; }
        .active-tab { background-color: #0f766e !important; color: white !important; }
        #notesSidebar { transition: transform 0.3s ease-in-out; }
        .sidebar-open { transform: translateX(0) !important; }
        #noteModalOverlay { background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); }
        .column-drop-zone { min-height: 200px; border-radius: 1rem; transition: background 0.2s; }
        .drag-over { background-color: rgba(94, 234, 212, 0.1); border: 2px dashed #5eead4; }
        
        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .priority-low { border-right: 5px solid #10b981; } /* Ø£Ø®Ø¶Ø± */
        .priority-medium { border-right: 5px solid #f59e0b; } /* Ø£ØµÙØ± */
        .priority-high { border-right: 5px solid #ef4444; } /* Ø£Ø­Ù…Ø± */
        
        .dot-low { background-color: #10b981; }
        .dot-medium { background-color: #f59e0b; }
        .dot-high { background-color: #ef4444; }
    </style>
</head>
<body class="bg-bgLight dark:bg-bgDark text-slate-800 dark:text-slate-200 min-h-screen">

    <div id="noteModalOverlay" class="fixed inset-0 z-[200] hidden flex items-center justify-center p-4" onclick="closeNoteModal()">
        <div class="bg-white dark:bg-slate-800 w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden" onclick="event.stopPropagation()">
            <div class="p-4 bg-primaryDark text-white flex justify-between">
                <span class="font-bold">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</span>
                <button onclick="closeNoteModal()" class="text-2xl">&times;</button>
            </div>
            <div class="p-6 space-y-4 text-right">
                <input type="text" id="editNoteTitle" class="w-full p-2 border rounded dark:bg-slate-700 dark:border-slate-600 outline-none">
                <textarea id="editNoteContent" rows="6" class="w-full p-2 border rounded dark:bg-slate-700 dark:border-slate-600 outline-none resize-none"></textarea>
                <div class="flex justify-end gap-2">
                    <button onclick="saveNoteEdit()" class="bg-primaryDark text-white px-6 py-2 rounded-lg font-bold">Ø­ÙØ¸</button>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed top-5 left-5 z-50 flex flex-col gap-3">
        <button onclick="toggleTheme()" class="p-3 rounded-full bg-white dark:bg-slate-700 shadow-lg hover:scale-110 transition">
            <span id="themeIcon">ğŸŒ™</span>
        </button>
    </div>

    <div id="notesSidebar" class="fixed top-0 right-0 h-full w-80 bg-white dark:bg-slate-800 shadow-2xl z-[100] transform translate-x-full border-l dark:border-slate-700 flex flex-col">
        <div class="p-5 border-b dark:border-slate-700 flex justify-between bg-primaryDark text-white">
            <h3 class="font-bold">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
            <button onclick="toggleNotes()" class="text-2xl">&times;</button>
        </div>
        <div class="p-4 space-y-3 bg-slate-50 dark:bg-slate-900/50">
            <input type="text" id="noteTitleInput" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©" class="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600">
            <textarea id="noteContentInput" placeholder="Ø§Ù„Ù…Ø­ØªÙˆÙ‰..." class="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600 h-20"></textarea>
            <button onclick="addNote()" class="w-full bg-primaryDark text-white py-2 rounded font-bold">Ø¥Ø¶Ø§ÙØ©</button>
        </div>
        <div id="notesList" class="flex-1 overflow-y-auto p-4 space-y-2 text-right"></div>
    </div>

    <div id="authSection" class="min-h-screen flex items-center justify-center px-4">
        <div class="bg-white dark:bg-slate-800 p-8 rounded-2xl shadow-xl w-full max-w-md">
            <h1 class="text-4xl font-bold text-center text-primaryDark dark:text-primary mb-6">WP 2026</h1>
            <div class="space-y-4">
                <input type="email" id="emailInput" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full px-4 py-3 rounded-xl border dark:bg-slate-700 dark:border-slate-600 outline-none">
                <input type="password" id="passInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full px-4 py-3 rounded-xl border dark:bg-slate-700 dark:border-slate-600 outline-none">
                <button onclick="handleLogin()" class="w-full bg-primaryDark text-white py-3 rounded-xl font-bold">Ø¯Ø®ÙˆÙ„</button>
                <button onclick="handleRegister()" class="w-full border-2 border-primaryDark text-primaryDark py-3 rounded-xl font-bold">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
            </div>
        </div>
    </div>

    <div id="mainApp" class="hidden-section text-right">
        <nav class="bg-white dark:bg-slate-800 shadow-md sticky top-0 z-40 mb-6 border-b dark:border-slate-700">
            <div class="container mx-auto px-4 flex justify-between items-center h-16">
                <span class="text-2xl font-bold text-primaryDark dark:text-primary">WP 2026</span>
                <div class="flex gap-2">
                    <button onclick="switchTab('goals')" id="tab-goals" class="px-3 py-2 rounded-lg text-sm font-bold bg-slate-100 dark:bg-slate-700">Ø§Ù„Ø³Ù†Ø©</button>
                    <button onclick="switchTab('monthly')" id="tab-monthly" class="px-3 py-2 rounded-lg text-sm font-bold bg-slate-100 dark:bg-slate-700">Ø§Ù„Ø´Ù‡ÙˆØ±</button>
                    <button onclick="switchTab('weekly')" id="tab-weekly" class="px-3 py-2 rounded-lg text-sm font-bold bg-slate-100 dark:bg-slate-700">Ø§Ù„Ø£Ø³Ø§Ø¨ÙŠØ¹</button>
                    <button onclick="toggleNotes()" class="px-3 py-2 rounded-lg text-sm font-bold bg-yellow-100 text-yellow-700">ğŸ“</button>
                    <button onclick="logout()" class="px-3 py-2 rounded-lg text-sm font-bold bg-red-100 text-red-600">Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto px-4 pb-10 max-w-5xl">
            <div class="mb-6 text-center">
                <h2 id="sectionTitle" class="text-3xl font-bold text-primaryDark dark:text-primary mb-2"></h2>
                <div class="max-w-md mx-auto bg-slate-200 dark:bg-slate-700 rounded-full h-4 mb-2 overflow-hidden shadow-inner">
                    <div id="progressFill" class="bg-primaryDark h-full transition-all duration-500" style="width: 0%"></div>
                </div>
                <p class="text-sm font-bold text-slate-500">ØªÙ… Ø¥Ù†Ø¬Ø§Ø² <span id="progressText">0%</span></p>
            </div>
            
            <div class="max-w-xl mx-auto flex flex-col md:flex-row gap-2 mb-10">
                <input type="text" id="taskInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ù…Ø© Ù‡Ù†Ø§..." class="flex-1 bg-white dark:bg-slate-800 border rounded-xl px-4 py-3 outline-none focus:ring-2 focus:ring-primary shadow-sm">
                <select id="taskPriority" class="bg-white dark:bg-slate-800 border rounded-xl px-2 py-3 text-sm outline-none">
                    <option value="low">Ø¹Ø§Ø¯ÙŠ (Ø£Ø®Ø¶Ø±)</option>
                    <option value="medium">Ù…ØªÙˆØ³Ø· (Ø£ØµÙØ±)</option>
                    <option value="high">Ø¹Ø§Ø¬Ù„ (Ø£Ø­Ù…Ø±)</option>
                </select>
                <button onclick="addTask()" class="bg-primaryDark text-white rounded-xl px-8 py-3 font-bold shadow-lg hover:bg-teal-700 transition">Ø¥Ø¶Ø§ÙØ©</button>
            </div>

            <div id="selectionBar" class="mb-8 overflow-x-auto flex justify-center gap-2 p-2"></div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-lg border-t-4 border-red-400">
                    <h3 class="font-bold mb-4 flex justify-between items-center text-lg">ğŸ›‘ Ù„Ù„Ù‚ÙŠØ§Ù… <span id="count-todo" class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full">0</span></h3>
                    <div id="col-todo" class="column-drop-zone space-y-3" ondragover="allowDrop(event)" ondragleave="clearStyle(event)" ondrop="handleDrop(event, 'todo')"></div>
                </div>
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-lg border-t-4 border-yellow-400">
                    <h3 class="font-bold mb-4 flex justify-between items-center text-lg">ğŸš§ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ <span id="count-doing" class="text-xs bg-yellow-100 text-yellow-600 px-2 py-1 rounded-full">0</span></h3>
                    <div id="col-doing" class="column-drop-zone space-y-3" ondragover="allowDrop(event)" ondragleave="clearStyle(event)" ondrop="handleDrop(event, 'doing')"></div>
                </div>
                <div class="bg-white dark:bg-slate-800 rounded-2xl p-5 shadow-lg border-t-4 border-green-400">
                    <h3 class="font-bold mb-4 flex justify-between items-center text-lg">âœ… Ù…Ù†Ø¬Ø² <span id="count-done" class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full">0</span></h3>
                    <div id="col-done" class="column-drop-zone space-y-3" ondragover="allowDrop(event)" ondragleave="clearStyle(event)" ondrop="handleDrop(event, 'done')"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = JSON.parse(localStorage.getItem('wp_logged_in')) || null;
        let currentTab = 'goals';
        let selectedSubKey = '2026';
        let activeEditNoteId = null;

        const sectionTitles = { goals: "Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", monthly: "Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø´Ù‡Ø±", weekly: "Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©" };

        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.theme = isDark ? 'dark' : 'light';
            document.getElementById('themeIcon').innerText = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        function toggleNotes() { document.getElementById('notesSidebar').classList.toggle('sidebar-open'); }

        function addNote() {
            const title = document.getElementById('noteTitleInput').value.trim();
            const content = document.getElementById('noteContentInput').value.trim();
            if(!title || !content) return;
            if(!currentUser.notes) currentUser.notes = [];
            currentUser.notes.unshift({ id: 'n'+Date.now(), title, content });
            document.getElementById('noteTitleInput').value = '';
            document.getElementById('noteContentInput').value = '';
            saveData(); renderNotes();
        }

        function renderNotes() {
            const container = document.getElementById('notesList');
            container.innerHTML = '';
            (currentUser?.notes || []).forEach(n => {
                const div = document.createElement('div');
                div.className = 'bg-slate-100 dark:bg-slate-700 p-3 rounded-lg border-r-4 border-primaryDark cursor-pointer group shadow-sm';
                div.onclick = () => {
                    activeEditNoteId = n.id;
                    document.getElementById('editNoteTitle').value = n.title;
                    document.getElementById('editNoteContent').value = n.content;
                    document.getElementById('noteModalOverlay').classList.remove('hidden');
                };
                div.innerHTML = `<div class="flex justify-between font-bold text-sm"><span>${n.title}</span><button onclick="event.stopPropagation(); deleteNote('${n.id}')" class="text-red-400 opacity-0 group-hover:opacity-100">âœ•</button></div>`;
                container.appendChild(div);
            });
        }

        function closeNoteModal() { document.getElementById('noteModalOverlay').classList.add('hidden'); }
        function saveNoteEdit() {
            const note = currentUser.notes.find(n => n.id === activeEditNoteId);
            if(note) {
                note.title = document.getElementById('editNoteTitle').value;
                note.content = document.getElementById('editNoteContent').value;
                saveData(); renderNotes(); closeNoteModal();
            }
        }
        function deleteNote(id) {
            currentUser.notes = currentUser.notes.filter(n => n.id !== id);
            saveData(); renderNotes();
        }

        function switchTab(tab) {
            currentTab = tab;
            selectedSubKey = tab === 'goals' ? '2026' : (tab === 'monthly' ? 'ÙŠÙ†Ø§ÙŠØ±' : 'Ø§Ù„Ø³Ø¨Øª');
            document.getElementById('sectionTitle').innerText = sectionTitles[tab];
            renderSelectionBar();
            renderBoard();
            updateTabUI();
        }

        function updateTabUI() {
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active-tab'));
            document.getElementById('tab-' + currentTab)?.classList.add('active-tab');
        }

        function renderSelectionBar() {
            const bar = document.getElementById('selectionBar');
            bar.innerHTML = '';
            if(currentTab !== 'goals') {
                const list = currentTab === 'monthly' ? ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'] : ['Ø§Ù„Ø³Ø¨Øª','Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©'];
                list.forEach(item => {
                    const btn = document.createElement('button');
                    btn.innerText = item;
                    btn.className = `px-4 py-1.5 rounded-full text-xs font-bold transition ${selectedSubKey === item ? 'bg-primaryDark text-white shadow-md' : 'bg-slate-200 dark:bg-slate-700'}`;
                    btn.onclick = () => { selectedSubKey = item; renderSelectionBar(); renderBoard(); };
                    bar.appendChild(btn);
                });
            }
        }

        function addTask() {
            const val = document.getElementById('taskInput').value.trim();
            const priority = document.getElementById('taskPriority').value;
            if(!val) return;
            if(!currentUser.tasks) currentUser.tasks = {};
            if(!currentUser.tasks[currentTab]) currentUser.tasks[currentTab] = {};
            if(!currentUser.tasks[currentTab][selectedSubKey]) currentUser.tasks[currentTab][selectedSubKey] = [];
            
            currentUser.tasks[currentTab][selectedSubKey].push({ id: 't'+Date.now(), text: val, status: 'todo', priority: priority });
            document.getElementById('taskInput').value = '';
            saveData();
        }

        function calculateProgress(tasks) {
            if (tasks.length === 0) return 0;
            const doneCount = tasks.filter(t => t.status === 'done').length;
            return Math.round((doneCount / tasks.length) * 100);
        }

        function renderBoard() {
            const cols = { todo: document.getElementById('col-todo'), doing: document.getElementById('col-doing'), done: document.getElementById('col-done') };
            Object.values(cols).forEach(c => c.innerHTML = '');
            const tasks = currentUser.tasks?.[currentTab]?.[selectedSubKey] || [];
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©
            const progress = calculateProgress(tasks);
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').innerText = progress + '%';

            let counts = {todo:0, doing:0, done:0};
            tasks.forEach(t => {
                counts[t.status]++;
                const d = document.createElement('div');
                d.id = t.id; d.draggable = true;
                d.className = `bg-white dark:bg-slate-700 p-4 rounded-xl shadow border dark:border-slate-600 flex justify-between items-center group cursor-grab priority-${t.priority}`;
                
                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ù…Ù„ÙˆÙ†Ø©
                d.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 rounded-full dot-${t.priority} shadow-sm"></div>
                        <span class="text-sm font-bold ${t.status === 'done' ? 'line-through text-slate-400' : ''}">${t.text}</span>
                    </div>
                    <button onclick="deleteTask('${t.id}')" class="text-red-400 opacity-0 group-hover:opacity-100 transition px-2">âœ•</button>
                `;
                
                d.ondragstart = (e) => { e.dataTransfer.setData("text", e.target.id); e.target.style.opacity = "0.5"; };
                d.ondragend = (e) => e.target.style.opacity = "1";
                cols[t.status].appendChild(d);
            });
            Object.keys(counts).forEach(k => document.getElementById('count-'+k).innerText = counts[k]);
        }

        window.allowDrop = (e) => { e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
        window.clearStyle = (e) => e.currentTarget.classList.remove('drag-over');
        window.handleDrop = (e, status) => {
            e.preventDefault(); e.currentTarget.classList.remove('drag-over');
            const id = e.dataTransfer.getData("text");
            const tasks = currentUser.tasks[currentTab][selectedSubKey];
            const t = tasks.find(x => x.id === id);
            if(t) { t.status = status; saveData(); }
        }

        function deleteTask(id) {
            currentUser.tasks[currentTab][selectedSubKey] = currentUser.tasks[currentTab][selectedSubKey].filter(t => t.id !== id);
            saveData();
        }

        function saveData() {
            localStorage.setItem('wp_logged_in', JSON.stringify(currentUser));
            let users = JSON.parse(localStorage.getItem('wp_users')) || [];
            let idx = users.findIndex(u => u.email === currentUser.email);
            if(idx !== -1) { users[idx] = currentUser; localStorage.setItem('wp_users', JSON.stringify(users)); }
            renderBoard();
        }

        function handleLogin() {
            const e = document.getElementById('emailInput').value;
            const p = document.getElementById('passInput').value;
            const u = (JSON.parse(localStorage.getItem('wp_users')) || []).find(x => x.email === e && x.pass === p);
            if(u) { currentUser = u; localStorage.setItem('wp_logged_in', JSON.stringify(u)); checkAuth(); }
        }

        function handleRegister() {
            const e = document.getElementById('emailInput').value;
            const p = document.getElementById('passInput').value;
            if(!e || !p) return;
            let users = JSON.parse(localStorage.getItem('wp_users')) || [];
            if(users.find(x => x.email === e)) return alert("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯");
            users.push({email:e, pass:p, tasks:{}, notes:[]});
            localStorage.setItem('wp_users', JSON.stringify(users));
            alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„!");
        }

        function checkAuth() {
            if(currentUser) {
                document.getElementById('authSection').classList.add('hidden-section');
                document.getElementById('mainApp').classList.remove('hidden-section');
                switchTab('goals');
                renderNotes();
            }
        }

        function logout() { localStorage.removeItem('wp_logged_in'); location.reload(); }
        if(localStorage.theme === 'dark') document.documentElement.classList.add('dark');
        checkAuth();
    </script>
</body>
</html>
